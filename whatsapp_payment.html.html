<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiement Autres Pays Africains - Boosteph</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary: #6c63ff;
            --primary-dark: #554fd8;
            --secondary: #ff6584;
            --dark: #1a1a2e;
            --dark-light: #2a2a3e;
            --light: #f8f9fa;
            --gray: #8a8a9e;
            --success: #36d399;
            --warning: #fbbf24;
            --error: #ff4757;
            --whatsapp: #25D366;
            --whatsapp-dark: #128C7E;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .header p {
            color: var(--gray);
        }

        .whatsapp-header {
            background: linear-gradient(135deg, var(--whatsapp) 0%, var(--whatsapp-dark) 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .whatsapp-header i {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .whatsapp-header h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .info-box {
            background: rgba(108, 99, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary);
        }

        .info-box h3 {
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-box p {
            color: var(--dark);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .info-box ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        .info-box li {
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(108, 99, 255, 0.1);
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
            background-color: white;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
        }

        .amount-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .amount-option {
            padding: 15px;
            border: 2px solid rgba(108, 99, 255, 0.1);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--dark);
        }

        .amount-option:hover,
        .amount-option.selected {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.05);
            color: var(--primary);
        }

        .payment-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-method {
            flex: 1;
            padding: 15px;
            border: 2px solid rgba(108, 99, 255, 0.1);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover,
        .payment-method.selected {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.05);
        }

        .payment-method i {
            font-size: 24px;
            margin-bottom: 5px;
            display: block;
        }

        .payment-method span {
            display: block;
            font-size: 12px;
            color: var(--gray);
        }

        .phone-group {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 15px;
            align-items: center;
        }

        .phone-prefix {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(108, 99, 255, 0.1);
            font-weight: 500;
            min-width: 120px;
            text-align: center;
        }

        .payment-summary {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .payment-summary .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .payment-summary .row:last-child {
            margin-bottom: 0;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .payment-summary .label {
            color: var(--gray);
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, var(--whatsapp) 0%, var(--whatsapp-dark) 100%);
            color: white;
        }

        .btn-whatsapp:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 211, 102, 0.3);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            text-decoration: none;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .back-link:hover {
            color: var(--primary);
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: rgba(54, 211, 153, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .alert-error {
            background: rgba(255, 71, 87, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .whatsapp-note {
            background: rgba(37, 211, 102, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            border: 1px solid rgba(37, 211, 102, 0.3);
        }

        .whatsapp-note i {
            color: var(--whatsapp);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .whatsapp-note p {
            font-size: 0.9rem;
            color: var(--dark);
            line-height: 1.5;
        }

        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(108, 99, 255, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="depot.html" class="back-link">
            <i class="fas fa-arrow-left"></i> Retour aux paiements
        </a>
        
        <div class="whatsapp-header">
            <i class="fab fa-whatsapp"></i>
            <h2>Paiement Autres Pays Africains</h2>
            <p>Haute pays africain</p>
        </div>

        <div class="alert" id="successAlert">
            <i class="fas fa-check-circle"></i>
            <span id="successMessage"></span>
        </div>

        <div class="alert" id="errorAlert">
            <i class="fas fa-exclamation-circle"></i>
            <span id="errorMessage"></span>
        </div>

        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p style="margin-top: 10px; color: var(--gray);">Traitement en cours...</p>
        </div>

        <div class="info-box">
            <h3><i class="fas fa-info-circle"></i> Comment √ßa marche ?</h3>
            <p>Pour effectuer un d√©p√¥t depuis un autre pays africain, veuillez remplir ce formulaire avec vos informations de paiement. Une fois le formulaire soumis :</p>
            <ul>
                <li>Vous serez redirig√© vers WhatsApp avec un message pr√©-rempli</li>
                <li>Notre √©quipe vous r√©pondra rapidement pour vous expliquer la proc√©dure</li>
                <li>Nous cr√©erons un lien de paiement personnalis√© pour vous</li>
                <li>Vous recevrez le lien de paiement par WhatsApp ou email</li>
                <li>Apr√®s paiement, votre solde sera cr√©dit√© dans les plus brefs d√©lais</li>
            </ul>
            <p><strong>Num√©ro WhatsApp : +237 6 40 35 25 24</strong></p>
        </div>

        <form id="paymentForm">
            <div class="form-group">
                <label>Montant de recharge (XAF)</label>
                <div class="amount-options">
                    <div class="amount-option" data-amount="5000">5 000 XAF</div>
                    <div class="amount-option" data-amount="10000">10 000 XAF</div>
                    <div class="amount-option" data-amount="20000">20 000 XAF</div>
                    <div class="amount-option" data-amount="50000">50 000 XAF</div>
                    <div class="amount-option" data-amount="100000">100 000 XAF</div>
                    <div class="amount-option" data-amount="200000">200 000 XAF</div>
                </div>
            </div>

            <div class="form-group">
                <label for="customAmount">Ou montant personnalis√© (XAF)</label>
                <input type="number" id="customAmount" placeholder="Ex: 15000" min="5000">
            </div>

            <div class="form-group">
                <label for="country">Pays *</label>
                <select id="country" required>
                    <option value="">S√©lectionnez votre pays</option>
                    <!-- Afrique de l'Ouest -->
                    <option value="benin">B√©nin</option>
                    <option value="burkina-faso">Burkina Faso</option>
                    <option value="cote-ivoire">C√¥te d'Ivoire</option>
                    <option value="gambie">Gambie</option>
                    <option value="ghana">Ghana</option>
                    <option value="guinee">Guin√©e</option>
                    <option value="guinee-bissau">Guin√©e-Bissau</option>
                    <option value="liberia">Lib√©ria</option>
                    <option value="mali">Mali</option>
                    <option value="niger">Niger</option>
                    <option value="nigeria">Nigeria</option>
                    <option value="senegal">S√©n√©gal</option>
                    <option value="sierra-leone">Sierra Leone</option>
                    <option value="togo">Togo</option>
                    
                    <!-- Afrique Centrale -->
                    <option value="gabon">Gabon</option>
                    <option value="guinee-equatoriale">Guin√©e √âquatoriale</option>
                    <option value="rdc">R√©publique D√©mocratique du Congo</option>
                    <option value="republique-centrafricaine">R√©publique Centrafricaine</option>
                    <option value="republique-congo">R√©publique du Congo</option>
                    <option value="tchad">Tchad</option>
                    
                    <!-- Afrique de l'Est -->
                    <option value="burundi">Burundi</option>
                    <option value="djibouti">Djibouti</option>
                    <option value="erythree">√ârythr√©e</option>
                    <option value="ethiopie">√âthiopie</option>
                    <option value="kenya">Kenya</option>
                    <option value="rwanda">Rwanda</option>
                    <option value="somalie">Somalie</option>
                    <option value="soudan">Soudan</option>
                    <option value="soudan-sud">Soudan du Sud</option>
                    <option value="tanzanie">Tanzanie</option>
                    <option value="uganda">Ouganda</option>
                    
                    <!-- Afrique Australe -->
                    <option value="angola">Angola</option>
                    <option value="botswana">Botswana</option>
                    <option value="comores">Comores</option>
                    <option value="lesotho">Lesotho</option>
                    <option value="madagascar">Madagascar</option>
                    <option value="malawi">Malawi</option>
                    <option value="ile-maurice">√éle Maurice</option>
                    <option value="mozambique">Mozambique</option>
                    <option value="namibie">Namibie</option>
                    <option value="seychelles">Seychelles</option>
                    <option value="afrique-sud">Afrique du Sud</option>
                    <option value="swaziland">Eswatini (Swaziland)</option>
                    <option value="zambie">Zambie</option>
                    <option value="zimbabwe">Zimbabwe</option>
                </select>
            </div>

            <div class="form-group">
                <label for="phoneNumber">Num√©ro de t√©l√©phone *</label>
                <div class="phone-group">
                    <div class="phone-prefix" id="phonePrefix">+229</div>
                    <input type="tel" id="phoneNumber" required placeholder="Ex: 01 23 45 67">
                </div>
            </div>

            <div class="form-group">
                <label>Mode de paiement *</label>
                <div class="payment-methods">
                    <div class="payment-method selected" data-method="momo">
                        <i class="fas fa-mobile-alt" style="color: #FFCC00;"></i>
                        <span>MTN Mobile Money</span>
                    </div>
                    <div class="payment-method" data-method="om">
                        <i class="fas fa-mobile-alt" style="color: #FF6600;"></i>
                        <span>Orange Money</span>
                    </div>
                    <div class="payment-method" data-method="wave">
                        <i class="fas fa-wave-square" style="color: #00AEF0;"></i>
                        <span>Wave</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="fullName">Nom complet *</label>
                <input type="text" id="fullName" required placeholder="Votre nom complet">
            </div>

            <div class="form-group">
                <label for="userEmail">Adresse email *</label>
                <input type="email" id="userEmail" required placeholder="Ex: votrenom@email.com">
            </div>

            <div class="form-group">
                <label for="additionalInfo">Informations suppl√©mentaires</label>
                <textarea id="additionalInfo" rows="3" placeholder="Op√©rateur, nom de l'exp√©diteur, ou autres d√©tails utiles..."></textarea>
            </div>

            <div class="payment-summary">
                <div class="row">
                    <span class="label">Montant</span>
                    <span id="displayAmount">0</span>
                </div>
                <div class="row">
                    <span class="label">Pays</span>
                    <span id="displayCountry">-</span>
                </div>
                <div class="row">
                    <span class="label">M√©thode</span>
                    <span id="displayMethod">-</span>
                </div>
                <div class="row">
                    <span class="label">Num√©ro</span>
                    <span id="displayPhone">-</span>
                </div>
                <div class="row">
                    <span class="label">Total √† payer</span>
                    <span id="displayTotal">0 XAF</span>
                </div>
            </div>

            <div class="whatsapp-note">
                <i class="fab fa-whatsapp"></i>
                <p>Apr√®s avoir cliqu√© sur le bouton, vous serez redirig√© vers WhatsApp avec un message pr√©-rempli. Notre √©quipe vous r√©pondra rapidement pour vous expliquer la proc√©dure et vous envoyer votre lien de paiement personnalis√©.</p>
            </div>

            <button type="button" class="btn btn-whatsapp" id="submitBtn">
                <i class="fab fa-whatsapp"></i> Envoyer la demande sur WhatsApp
            </button>
        </form>

        <button class="btn btn-secondary" onclick="window.location.href='depot.html'">
            <i class="fas fa-arrow-left"></i> Retour aux paiements automatiques
        </button>
    </div>

    <script>
        // M√äME CONFIGURATION FIREBASE QUE LE FICHIER depot.html
        const firebaseConfig = {
            apiKey: "AIzaSyBvVXfiFmnIVEZzaugsxt43ov0YU7quIhY",
            authDomain: "monsiteweb-beaee.firebaseapp.com",
            databaseURL: "https://monsiteweb-beaee-default-rtdb.firebaseio.com",
            projectId: "monsiteweb-beaee",
            storageBucket: "monsiteweb-beaee.firebasestorage.app",
            messagingSenderId: "847850292961",
            appId: "1:847850292961:web:6527ea0d8d2848aec119a0",
            measurementId: "G-3JGDX6G06N"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Donn√©es des pays avec indicatifs
        const countriesData = {
            'benin': { prefix: '+229', name: 'B√©nin' },
            'burkina-faso': { prefix: '+226', name: 'Burkina Faso' },
            'cote-ivoire': { prefix: '+225', name: 'C√¥te d\'Ivoire' },
            'gambie': { prefix: '+220', name: 'Gambie' },
            'ghana': { prefix: '+233', name: 'Ghana' },
            'guinee': { prefix: '+224', name: 'Guin√©e' },
            'guinee-bissau': { prefix: '+245', name: 'Guin√©e-Bissau' },
            'liberia': { prefix: '+231', name: 'Lib√©ria' },
            'mali': { prefix: '+223', name: 'Mali' },
            'niger': { prefix: '+227', name: 'Niger' },
            'nigeria': { prefix: '+234', name: 'Nigeria' },
            'senegal': { prefix: '+221', name: 'S√©n√©gal' },
            'sierra-leone': { prefix: '+232', name: 'Sierra Leone' },
            'togo': { prefix: '+228', name: 'Togo' },
            'gabon': { prefix: '+241', name: 'Gabon' },
            'guinee-equatoriale': { prefix: '+240', name: 'Guin√©e √âquatoriale' },
            'rdc': { prefix: '+243', name: 'R√©publique D√©mocratique du Congo' },
            'republique-centrafricaine': { prefix: '+236', name: 'R√©publique Centrafricaine' },
            'republique-congo': { prefix: '+242', name: 'R√©publique du Congo' },
            'tchad': { prefix: '+235', name: 'Tchad' },
            'burundi': { prefix: '+257', name: 'Burundi' },
            'djibouti': { prefix: '+253', name: 'Djibouti' },
            'erythree': { prefix: '+291', name: '√ârythr√©e' },
            'ethiopie': { prefix: '+251', name: '√âthiopie' },
            'kenya': { prefix: '+254', name: 'Kenya' },
            'rwanda': { prefix: '+250', name: 'Rwanda' },
            'somalie': { prefix: '+252', name: 'Somalie' },
            'soudan': { prefix: '+249', name: 'Soudan' },
            'soudan-sud': { prefix: '+211', name: 'Soudan du Sud' },
            'tanzanie': { prefix: '+255', name: 'Tanzanie' },
            'uganda': { prefix: '+256', name: 'Ouganda' },
            'angola': { prefix: '+244', name: 'Angola' },
            'botswana': { prefix: '+267', name: 'Botswana' },
            'comores': { prefix: '+269', name: 'Comores' },
            'lesotho': { prefix: '+266', name: 'Lesotho' },
            'madagascar': { prefix: '+261', name: 'Madagascar' },
            'malawi': { prefix: '+265', name: 'Malawi' },
            'ile-maurice': { prefix: '+230', name: '√éle Maurice' },
            'mozambique': { prefix: '+258', name: 'Mozambique' },
            'namibie': { prefix: '+264', name: 'Namibie' },
            'seychelles': { prefix: '+248', name: 'Seychelles' },
            'afrique-sud': { prefix: '+27', name: 'Afrique du Sud' },
            'swaziland': { prefix: '+268', name: 'Eswatini (Swaziland)' },
            'zambie': { prefix: '+260', name: 'Zambie' },
            'zimbabwe': { prefix: '+263', name: 'Zimbabwe' }
        };

        // Variables globales
        let currentUser = null;
        let selectedAmount = 0;
        const whatsappNumber = "237640352524"; // Num√©ro WhatsApp de Boosteph

        // V√©rifier l'authentification
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
            } else {
                // Rediriger vers la page de connexion si non connect√©
                window.location.href = 'connexion.html';
            }
        });

        // Charger les donn√©es utilisateur
        async function loadUserData() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    
                    // Pr√©-remplir l'email avec celui de Firebase Auth
                    document.getElementById('userEmail').value = currentUser.email || userData.email || '';
                    
                    // Pr√©-remplir le nom complet
                    if (userData.fullName) {
                        document.getElementById('fullName').value = userData.fullName;
                    } else if (userData.displayName) {
                        document.getElementById('fullName').value = userData.displayName;
                    } else if (currentUser.displayName) {
                        document.getElementById('fullName').value = currentUser.displayName;
                    }
                    
                    // Pr√©-remplir le t√©l√©phone si disponible
                    if (userData.phoneNumber) {
                        const phone = userData.phoneNumber;
                        // Extraire l'indicatif et le num√©ro
                        if (phone.startsWith('+')) {
                            const prefixMatch = phone.match(/^\+(\d{1,4})/);
                            if (prefixMatch) {
                                const prefix = '+' + prefixMatch[1];
                                const number = phone.substring(prefixMatch[0].length).trim();
                                
                                // Trouver le pays correspondant √† l'indicatif
                                for (const [code, data] of Object.entries(countriesData)) {
                                    if (data.prefix === prefix) {
                                        document.getElementById('country').value = code;
                                        updatePhonePrefix();
                                        break;
                                    }
                                }
                                
                                document.getElementById('phoneNumber').value = number;
                            }
                        }
                    }
                }
                showLoader(false);
            } catch (error) {
                console.error('Erreur chargement donn√©es:', error);
                showLoader(false);
            }
        }

        // Gestion des montants rapides
        document.querySelectorAll('.amount-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.amount-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                selectedAmount = parseInt(this.dataset.amount);
                document.getElementById('customAmount').value = selectedAmount;
                updateSummary();
            });
        });

        // Gestion du montant personnalis√©
        document.getElementById('customAmount').addEventListener('input', function() {
            selectedAmount = parseInt(this.value) || 0;
            document.querySelectorAll('.amount-option').forEach(o => o.classList.remove('selected'));
            updateSummary();
        });

        // Gestion des m√©thodes de paiement
        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', function() {
                document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                this.classList.add('selected');
                updateSummary();
            });
        });

        // Mettre √† jour l'indicatif du t√©l√©phone
        function updatePhonePrefix() {
            const country = document.getElementById('country').value;
            const phonePrefix = document.getElementById('phonePrefix');
            
            if (country && countriesData[country]) {
                phonePrefix.textContent = countriesData[country].prefix;
            } else {
                phonePrefix.textContent = '+229'; // Valeur par d√©faut (B√©nin)
            }
            updateSummary();
        }

        // Mettre √† jour le r√©sum√©
        function updateSummary() {
            const country = document.getElementById('country').value;
            const method = document.querySelector('.payment-method.selected')?.dataset.method;
            const amount = selectedAmount || parseInt(document.getElementById('customAmount').value) || 0;
            const phone = document.getElementById('phoneNumber').value;
            const prefix = document.getElementById('phonePrefix').textContent;
            
            // Mettre √† jour les affichages
            if (country && countriesData[country]) {
                document.getElementById('displayCountry').textContent = countriesData[country].name;
            } else {
                document.getElementById('displayCountry').textContent = '-';
            }
            
            if (method) {
                const methodNames = {
                    'momo': 'MTN Mobile Money',
                    'om': 'Orange Money',
                    'wave': 'Wave'
                };
                document.getElementById('displayMethod').textContent = methodNames[method] || method;
            } else {
                document.getElementById('displayMethod').textContent = '-';
            }
            
            document.getElementById('displayAmount').textContent = amount.toLocaleString('fr-FR') + ' XAF';
            document.getElementById('displayTotal').textContent = amount.toLocaleString('fr-FR') + ' XAF';
            
            if (phone) {
                document.getElementById('displayPhone').textContent = prefix + ' ' + phone;
            } else {
                document.getElementById('displayPhone').textContent = '-';
            }
            
            // Valider le formulaire
            validateForm();
        }

        // Valider le formulaire
        function validateForm() {
            const country = document.getElementById('country').value;
            const amount = selectedAmount || parseInt(document.getElementById('customAmount').value);
            const phone = document.getElementById('phoneNumber').value;
            const email = document.getElementById('userEmail').value;
            const fullName = document.getElementById('fullName').value;
            const submitBtn = document.getElementById('submitBtn');
            
            // Validation de l'email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            // Activer/d√©sactiver le bouton
            const isValid = country && 
                          amount && amount >= 5000 && 
                          phone && phone.length >= 8 && 
                          email && emailRegex.test(email) && 
                          fullName;
            
            submitBtn.disabled = !isValid;
        }

        // Afficher un message de succ√®s
        function showSuccess(message) {
            const alert = document.getElementById('successAlert');
            document.getElementById('successMessage').textContent = message;
            alert.className = 'alert alert-success';
            alert.style.display = 'flex';
        }

        // Afficher un message d'erreur
        function showError(message) {
            const alert = document.getElementById('errorAlert');
            document.getElementById('errorMessage').textContent = message;
            alert.className = 'alert alert-error';
            alert.style.display = 'flex';
        }

        // Cacher les alertes
        function hideAlerts() {
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('errorAlert').style.display = 'none';
        }

        // Afficher/cacher le loader
        function showLoader(show) {
            document.getElementById('loader').style.display = show ? 'block' : 'none';
            document.getElementById('submitBtn').disabled = show;
        }

        // G√©rer la soumission du formulaire
        async function handleSubmit() {
            const country = document.getElementById('country').value;
            const method = document.querySelector('.payment-method.selected').dataset.method;
            const amount = selectedAmount || parseInt(document.getElementById('customAmount').value);
            const phonePrefix = document.getElementById('phonePrefix').textContent;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const email = document.getElementById('userEmail').value;
            const fullName = document.getElementById('fullName').value;
            const additionalInfo = document.getElementById('additionalInfo').value;
            
            const fullPhone = `${phonePrefix} ${phoneNumber}`;
            
            // Validation
            if (!amount || amount < 5000) {
                showError('Le montant minimum est de 5000 XAF');
                return;
            }
            
            if (!phoneNumber || phoneNumber.length < 8) {
                showError('Veuillez entrer un num√©ro de t√©l√©phone valide');
                return;
            }

            try {
                showLoader(true);
                hideAlerts();

                // Enregistrer la demande dans Firebase (m√™me projet que depot.html)
                await db.collection('whatsapp_payments').add({
                    userId: currentUser.uid,
                    fullName: fullName,
                    country: countriesData[country]?.name || country,
                    amount: amount,
                    phoneNumber: fullPhone,
                    email: email,
                    paymentMethod: method,
                    additionalInfo: additionalInfo,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Cr√©er le message WhatsApp
                const paymentMethodNames = {
                    'momo': 'MTN Mobile Money',
                    'om': 'Orange Money',
                    'wave': 'Wave'
                };

                const message = `üì± *DEMANDE DE RECHARGE BOOSTEPH* üì±

üë§ *Client:* ${fullName}
üìß *Email:* ${email}
üåç *Pays:* ${countriesData[country]?.name || country}
üí∞ *Montant:* ${amount.toLocaleString('fr-FR')} XAF
üì± *M√©thode de paiement:* ${paymentMethodNames[method] || method}
‚òéÔ∏è *Num√©ro:* ${fullPhone}
üìù *Informations suppl√©mentaires:* ${additionalInfo || 'Aucune'}
üÜî *ID Utilisateur:* ${currentUser.uid}

‚è∞ *Date:* ${new Date().toLocaleString('fr-FR')}

‚úÖ Le client attend votre confirmation de paiement.`;

                // Encoder le message pour l'URL
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;

                showSuccess('Demande enregistr√©e! WhatsApp va s\'ouvrir. Veuillez envoyer le message au support.');
                
                // Ouvrir WhatsApp
                setTimeout(() => {
                    window.open(whatsappUrl, '_blank');
                }, 2000);

            } catch (error) {
                console.error("Erreur:", error);
                showError('Erreur lors de l\'enregistrement de la demande');
            } finally {
                showLoader(false);
            }
        }

        // Initialiser l'application
        function initializeApp() {
            showLoader(true);
            
            // √âcouter les changements
            document.getElementById('country').addEventListener('change', updatePhonePrefix);
            document.getElementById('phoneNumber').addEventListener('input', updateSummary);
            document.getElementById('userEmail').addEventListener('input', updateSummary);
            document.getElementById('fullName').addEventListener('input', updateSummary);
            document.getElementById('additionalInfo').addEventListener('input', updateSummary);
            document.getElementById('customAmount').addEventListener('input', updateSummary);
            
            // G√©rer la soumission
            document.getElementById('submitBtn').addEventListener('click', handleSubmit);
            
            // Initialiser
            updatePhonePrefix();
            updateSummary();
        }

        // D√©marrer l'application
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>