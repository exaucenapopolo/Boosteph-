<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paiement Autres Pays Africains - Boosteph</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --primary: #6c63ff;
            --primary-dark: #554fd8;
            --secondary: #ff6584;
            --dark: #1a1a2e;
            --dark-light: #2a2a3e;
            --light: #f8f9fa;
            --gray: #8a8a9e;
            --success: #36d399;
            --warning: #fbbf24;
            --error: #ff4757;
            --whatsapp: #25D366;
            --whatsapp-dark: #128C7E;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .header p {
            color: var(--gray);
        }

        .balance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .balance-card h3 {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .balance-card .amount {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .whatsapp-card {
            background: linear-gradient(135deg, var(--whatsapp) 0%, var(--whatsapp-dark) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .whatsapp-card h3 {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .whatsapp-card .whatsapp-number {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(108, 99, 255, 0.1);
            border-radius: 10px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(108, 99, 255, 0.3);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, var(--whatsapp) 0%, var(--whatsapp-dark) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-whatsapp:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 211, 102, 0.3);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: rgba(54, 211, 153, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .alert-error {
            background: rgba(255, 71, 87, 0.1);
            color: var(--error);
            border: 1px solid var(--error);
        }

        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(108, 99, 255, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .payment-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-method {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            border: 2px solid rgba(108, 99, 255, 0.1);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover, .payment-method.selected {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.05);
        }

        .payment-method i {
            font-size: 24px;
            margin-bottom: 5px;
            display: block;
        }

        .payment-method span {
            display: block;
            font-size: 12px;
            color: var(--gray);
        }

        .phone-group {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 15px;
            align-items: center;
        }

        .phone-prefix {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(108, 99, 255, 0.1);
            font-weight: 500;
            min-width: 100px;
            text-align: center;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            text-decoration: none;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .back-link:hover {
            color: var(--primary);
        }

        .info-box {
            background: rgba(108, 99, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
        }

        .info-box h4 {
            color: var(--dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-box p {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .info-box ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        .info-box li {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .summary-box {
            background: var(--light);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(108, 99, 255, 0.1);
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .summary-label {
            color: var(--gray);
        }

        .summary-value {
            color: var(--dark);
            font-weight: 500;
        }

        .currency-display {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        .currency-display strong {
            color: var(--primary);
        }

        .min-amount-info {
            background: rgba(255, 187, 36, 0.1);
            border: 1px solid var(--warning);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--dark);
            text-align: center;
        }

        .amount-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .currency-symbol {
            background: var(--light);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(108, 99, 255, 0.1);
            font-weight: 500;
            min-width: 60px;
            text-align: center;
        }

        .conversion-info {
            background: rgba(108, 99, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--dark);
            text-align: center;
        }

        .conversion-info strong {
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="depot.html" class="back-link">
            <i class="fas fa-arrow-left"></i> Retour aux paiements
        </a>
        
        <div class="header">
            <h1><i class="fab fa-whatsapp"></i> Paiement Autres Pays</h1>
            <p>Haute pays africain - Formulaire de paiement WhatsApp</p>
        </div>

        <div class="balance-card">
            <h3>Votre solde actuel</h3>
            <div class="amount" id="currentBalance">0 XAF</div>
        </div>

        <div class="whatsapp-card">
            <h3>Contact WhatsApp</h3>
            <div class="whatsapp-number">
                <i class="fab fa-whatsapp"></i> +237 6 40 35 25 24
            </div>
            <p>Notre √©quipe vous r√©pondra rapidement</p>
        </div>

        <div class="alert" id="successAlert">
            <i class="fas fa-check-circle"></i>
            <span id="successMessage"></span>
        </div>

        <div class="alert" id="errorAlert">
            <i class="fas fa-exclamation-circle"></i>
            <span id="errorMessage"></span>
        </div>

        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p style="margin-top: 10px; color: var(--gray);">Traitement en cours...</p>
        </div>

        <div class="info-box">
            <h4><i class="fas fa-info-circle"></i> Comment √ßa marche ?</h4>
            <p>Remplissez ce formulaire pour effectuer un d√©p√¥t depuis un autre pays africain :</p>
            <ul>
                <li>S√©lectionnez votre pays (la monnaie et m√©thodes de paiement s'adapteront automatiquement)</li>
                <li>Entrez le montant dans votre monnaie locale</li>
                <li>Choisissez votre m√©thode de paiement disponible dans votre pays</li>
                <li>Cliquez sur "Envoyer sur WhatsApp"</li>
                <li>Nous vous enverrons un lien de paiement personnalis√©</li>
            </ul>
        </div>

        <form id="whatsappPaymentForm">
            <div class="form-group">
                <label for="country">Pays *</label>
                <select id="country" required>
                    <option value="">S√©lectionnez votre pays</option>
                    <!-- Afrique de l'Ouest -->
                    <option value="benin">B√©nin (XOF - Franc CFA)</option>
                    <option value="burkina-faso">Burkina Faso (XOF - Franc CFA)</option>
                    <option value="cote-ivoire">C√¥te d'Ivoire (XOF - Franc CFA)</option>
                    <option value="gambie">Gambie (GMD - Dalasi)</option>
                    <option value="ghana">Ghana (GHS - Cedi)</option>
                    <option value="guinee">Guin√©e (GNF - Franc Guin√©en)</option>
                    <option value="liberia">Lib√©ria (LRD - Dollar Lib√©rien)</option>
                    <option value="mali">Mali (XOF - Franc CFA)</option>
                    <option value="niger">Niger (XOF - Franc CFA)</option>
                    <option value="nigeria">Nigeria (NGN - Naira)</option>
                    <option value="senegal">S√©n√©gal (XOF - Franc CFA)</option>
                    <option value="sierra-leone">Sierra Leone (SLL - Leone)</option>
                    <option value="togo">Togo (XOF - Franc CFA)</option>
                    
                    <!-- Afrique Centrale -->
                    <option value="cameroon">Cameroun (XAF - Franc CFA)</option>
                    <option value="gabon">Gabon (XAF - Franc CFA)</option>
                    <option value="rdc">R√©publique D√©mocratique du Congo (CDF - Franc Congolais)</option>
                    <option value="republique-congo">R√©publique du Congo (XAF - Franc CFA)</option>
                    <option value="tchad">Tchad (XAF - Franc CFA)</option>
                    
                    <!-- Afrique de l'Est -->
                    <option value="burundi">Burundi (BIF - Franc Burundais)</option>
                    <option value="ethiopie">√âthiopie (ETB - Birr)</option>
                    <option value="kenya">Kenya (KES - Shilling Kenyan)</option>
                    <option value="rwanda">Rwanda (RWF - Franc Rwandais)</option>
                    <option value="tanzanie">Tanzanie (TZS - Shilling Tanzanien)</option>
                    <option value="uganda">Ouganda (UGX - Shilling Ougandais)</option>
                    
                    <!-- Afrique Australe -->
                    <option value="angola">Angola (AOA - Kwanza)</option>
                    <option value="botswana">Botswana (BWP - Pula)</option>
                    <option value="madagascar">Madagascar (MGA - Ariary)</option>
                    <option value="mozambique">Mozambique (MZN - Metical)</option>
                    <option value="afrique-sud">Afrique du Sud (ZAR - Rand)</option>
                    <option value="zambie">Zambie (ZMW - Kwacha)</option>
                    <option value="zimbabwe">Zimbabwe (USD - Dollar US)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="paymentMethod">M√©thode de paiement *</label>
                <select id="paymentMethod" required>
                    <option value="">S√©lectionnez d'abord votre pays</option>
                </select>
            </div>

            <div class="form-group">
                <label for="amount">Montant √† d√©poser *</label>
                <div class="amount-input-group">
                    <div class="currency-symbol" id="currencySymbol">FCFA</div>
                    <input type="number" id="amount" required min="1" placeholder="Ex: 5000" step="100">
                </div>
                <div class="conversion-info" id="conversionInfo">
                    Conversion: <strong id="localAmount">0</strong> <span id="localCurrency">FCFA</span> = 
                    <strong id="xafAmount">0 XAF</strong>
                </div>
                <div class="min-amount-info" id="minAmountInfo">
                    Montant minimum: <strong id="minAmountDisplay">1 000</strong> <span id="minCurrency">FCFA</span>
                    (√©quivalent √† <strong id="minXAF">1 000 XAF</strong>)
                </div>
            </div>

            <div class="form-group">
                <label for="phoneNumber">Num√©ro de t√©l√©phone *</label>
                <div class="phone-group">
                    <div class="phone-prefix" id="phonePrefix">+229</div>
                    <input type="tel" id="phoneNumber" required placeholder="Ex: 01 23 45 67">
                </div>
            </div>

            <div class="form-group">
                <label for="fullName">Nom complet *</label>
                <input type="text" id="fullName" required placeholder="Votre nom complet">
            </div>

            <div class="form-group">
                <label for="userEmail">Adresse email *</label>
                <input type="email" id="userEmail" required placeholder="Ex: votrenom@email.com">
            </div>

            <div class="form-group">
                <label for="additionalInfo">Informations suppl√©mentaires</label>
                <textarea id="additionalInfo" rows="3" placeholder="Op√©rateur, nom de l'exp√©diteur, ou autres d√©tails utiles..."></textarea>
            </div>

            <div class="summary-box">
                <div class="summary-item">
                    <span class="summary-label">Montant local:</span>
                    <span class="summary-value">
                        <span id="displayLocalAmount">0</span> 
                        <span id="displayLocalCurrency">FCFA</span>
                    </span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">√âquivalent XAF:</span>
                    <span class="summary-value" id="displayXAF">0 XAF</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Pays:</span>
                    <span class="summary-value" id="displayCountry">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">M√©thode:</span>
                    <span class="summary-value" id="displayMethod">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Total √† payer:</span>
                    <span class="summary-value" id="displayTotal">0 XAF</span>
                </div>
            </div>

            <button type="button" class="btn btn-whatsapp" id="submitBtn">
                <i class="fab fa-whatsapp"></i> Envoyer sur WhatsApp
            </button>
        </form>

        <button class="btn btn-secondary" onclick="window.location.href='dashboard.html'">
            <i class="fas fa-home"></i> Retour au tableau de bord
        </button>
    </div>

    <script>
        // M√äME CONFIGURATION FIREBASE QUE LE FICHIER depot.html
        const firebaseConfig = {
            apiKey: "AIzaSyBvVXfiFmnIVEZzaugsxt43ov0YU7quIhY",
            authDomain: "monsiteweb-beaee.firebaseapp.com",
            databaseURL: "https://monsiteweb-beaee-default-rtdb.firebaseio.com",
            projectId: "monsiteweb-beaee",
            storageBucket: "monsiteweb-beaee.firebasestorage.app",
            messagingSenderId: "847850292961",
            appId: "1:847850292961:web:6527ea0d8d2848aec119a0",
            measurementId: "G-3JGDX6G06N"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // TAUX DE CHANGE R√âELS (approximatifs bas√©s sur les taux actuels)
        // Source: taux approximatifs au 2024
        const exchangeRates = {
            // 1 XAF = ? unit√© locale
            'XOF': 1,        // Franc CFA Ouest Africain (parit√© avec XAF)
            'XAF': 1,        // Franc CFA Centrafricain
            'CDF': 2.5,      // Franc Congolais: 1 XAF ‚âà 2.5 CDF
            'GHS': 0.012,    // Cedi Ghan√©en: 1 XAF ‚âà 0.012 GHS
            'NGN': 1.0,      // Naira Nig√©rian: 1 XAF ‚âà 1 NGN
            'GNF': 12,       // Franc Guin√©en: 1 XAF ‚âà 12 GNF
            'KES': 0.24,     // Shilling Kenyan: 1 XAF ‚âà 0.24 KES
            'TZS': 3.8,      // Shilling Tanzanien: 1 XAF ‚âà 3.8 TZS
            'UGX': 3.2,      // Shilling Ougandais: 1 XAF ‚âà 3.2 UGX
            'RWF': 1.8,      // Franc Rwandais: 1 XAF ‚âà 1.8 RWF
            'ZAR': 0.025,    // Rand Sud-Africain: 1 XAF ‚âà 0.025 ZAR
            'GMD': 0.06,     // Dalasi Gambien: 1 XAF ‚âà 0.06 GMD
            'LRD': 0.002,    // Dollar Lib√©rien: 1 XAF ‚âà 0.002 LRD
            'SLL': 120,      // Leone Sierra-L√©onais: 1 XAF ‚âà 120 SLL
            'BIF': 2.2,      // Franc Burundais: 1 XAF ‚âà 2.2 BIF
            'ETB': 0.06,     // Birr √âthiopien: 1 XAF ‚âà 0.06 ETB
            'AOA': 0.7,      // Kwanza Angolais: 1 XAF ‚âà 0.7 AOA
            'BWP': 0.014,    // Pula Botswanais: 1 XAF ‚âà 0.014 BWP
            'MGA': 7.5,      // Ariary Malgache: 1 XAF ‚âà 7.5 MGA
            'MZN': 0.07,     // Metical Mozambicain: 1 XAF ‚âà 0.07 MZN
            'ZMW': 0.035,    // Kwacha Zambien: 1 XAF ‚âà 0.035 ZMW
            'USD': 0.0016    // Dollar US: 1 XAF ‚âà 0.0016 USD
        };

        // Donn√©es des pays avec toutes les informations n√©cessaires
        const countriesData = {
            // Afrique de l'Ouest - Franc CFA (XOF)
            'benin': {
                prefix: '+229',
                name: 'B√©nin',
                currency: 'XOF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['MTN Mobile Money', 'Moov Money', 'Flutterwave', 'Paiement Bancaire']
            },
            'burkina-faso': {
                prefix: '+226',
                name: 'Burkina Faso',
                currency: 'XOF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['Orange Money', 'Moov Money', 'Wave']
            },
            'cote-ivoire': {
                prefix: '+225',
                name: 'C√¥te d\'Ivoire',
                currency: 'XOF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['Orange Money', 'MTN Mobile Money', 'Moov Money', 'Wave']
            },
            'mali': {
                prefix: '+223',
                name: 'Mali',
                currency: 'XOF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['Orange Money', 'Malitel Money']
            },
            'niger': {
                prefix: '+227',
                name: 'Niger',
                currency: 'XOF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['Orange Money', 'Moov Money']
            },
            'senegal': {
                prefix: '+221',
                name: 'S√©n√©gal',
                currency: 'XOF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['Orange Money', 'Free Money', 'Wave']
            },
            'togo': {
                prefix: '+228',
                name: 'Togo',
                currency: 'XOF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['Moov Money', 'Togocel Money']
            },
            
            // Afrique Centrale - Franc CFA (XAF)
            'cameroon': {
                prefix: '+237',
                name: 'Cameroun',
                currency: 'XAF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['MTN Mobile Money', 'Orange Money']
            },
            'gabon': {
                prefix: '+241',
                name: 'Gabon',
                currency: 'XAF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['Airtel Money', 'Moov Money']
            },
            'republique-congo': {
                prefix: '+242',
                name: 'R√©publique du Congo',
                currency: 'XAF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['MTN Mobile Money', 'Airtel Money']
            },
            'tchad': {
                prefix: '+235',
                name: 'Tchad',
                currency: 'XAF',
                currencySymbol: 'FCFA',
                currencyName: 'Franc CFA',
                paymentMethods: ['Airtel Money', 'Tigo Money']
            },
            
            // RDC - Franc Congolais (CDF)
            'rdc': {
                prefix: '+243',
                name: 'R√©publique D√©mocratique du Congo',
                currency: 'CDF',
                currencySymbol: 'FC',
                currencyName: 'Franc Congolais',
                paymentMethods: ['Orange Money', 'Vodacom M-Pesa', 'Airtel Money', 'Equity Bank']
            },
            
            // Ghana - Cedi (GHS)
            'ghana': {
                prefix: '+233',
                name: 'Ghana',
                currency: 'GHS',
                currencySymbol: '‚Çµ',
                currencyName: 'Cedi',
                paymentMethods: ['MTN Mobile Money', 'Vodafone Cash', 'AirtelTigo Money']
            },
            
            // Nigeria - Naira (NGN)
            'nigeria': {
                prefix: '+234',
                name: 'Nigeria',
                currency: 'NGN',
                currencySymbol: '‚Ç¶',
                currencyName: 'Naira',
                paymentMethods: ['Paga', 'Flutterwave', 'Paystack', 'Quickteller']
            },
            
            // Guin√©e - Franc Guin√©en (GNF)
            'guinee': {
                prefix: '+224',
                name: 'Guin√©e',
                currency: 'GNF',
                currencySymbol: 'FG',
                currencyName: 'Franc Guin√©en',
                paymentMethods: ['Orange Money', 'MTN Mobile Money']
            },
            
            // Kenya - Shilling Kenyan (KES)
            'kenya': {
                prefix: '+254',
                name: 'Kenya',
                currency: 'KES',
                currencySymbol: 'KSh',
                currencyName: 'Shilling Kenyan',
                paymentMethods: ['M-Pesa', 'Airtel Money', 'Equitel']
            },
            
            // Tanzanie - Shilling Tanzanien (TZS)
            'tanzanie': {
                prefix: '+255',
                name: 'Tanzanie',
                currency: 'TZS',
                currencySymbol: 'TSh',
                currencyName: 'Shilling Tanzanien',
                paymentMethods: ['M-Pesa', 'Tigo Pesa', 'Airtel Money']
            },
            
            // Ouganda - Shilling Ougandais (UGX)
            'uganda': {
                prefix: '+256',
                name: 'Ouganda',
                currency: 'UGX',
                currencySymbol: 'USh',
                currencyName: 'Shilling Ougandais',
                paymentMethods: ['MTN Mobile Money', 'Airtel Money']
            },
            
            // Rwanda - Franc Rwandais (RWF)
            'rwanda': {
                prefix: '+250',
                name: 'Rwanda',
                currency: 'RWF',
                currencySymbol: 'FRw',
                currencyName: 'Franc Rwandais',
                paymentMethods: ['MTN Mobile Money', 'Airtel Money']
            },
            
            // Afrique du Sud - Rand (ZAR)
            'afrique-sud': {
                prefix: '+27',
                name: 'Afrique du Sud',
                currency: 'ZAR',
                currencySymbol: 'R',
                currencyName: 'Rand',
                paymentMethods: ['FNB eWallet', 'Standard Bank Mobile Banking', 'Nedbank Money']
            },
            
            // Autres pays
            'gambie': {
                prefix: '+220',
                name: 'Gambie',
                currency: 'GMD',
                currencySymbol: 'D',
                currencyName: 'Dalasi',
                paymentMethods: ['QMoney', 'AfriMoney']
            },
            'liberia': {
                prefix: '+231',
                name: 'Lib√©ria',
                currency: 'LRD',
                currencySymbol: '$',
                currencyName: 'Dollar Lib√©rien',
                paymentMethods: ['Lonestar Cell MTN Mobile Money', 'Orange Money']
            },
            'sierra-leone': {
                prefix: '+232',
                name: 'Sierra Leone',
                currency: 'SLL',
                currencySymbol: 'Le',
                currencyName: 'Leone',
                paymentMethods: ['Orange Money', 'Africell Money']
            },
            'burundi': {
                prefix: '+257',
                name: 'Burundi',
                currency: 'BIF',
                currencySymbol: 'FBu',
                currencyName: 'Franc Burundais',
                paymentMethods: ['Lumicash', 'EcoCash']
            },
            'ethiopie': {
                prefix: '+251',
                name: '√âthiopie',
                currency: 'ETB',
                currencySymbol: 'Br',
                currencyName: 'Birr',
                paymentMethods: ['M-Birr', 'HelloCash']
            },
            'angola': {
                prefix: '+244',
                name: 'Angola',
                currency: 'AOA',
                currencySymbol: 'Kz',
                currencyName: 'Kwanza',
                paymentMethods: ['Unitel Money']
            },
            'botswana': {
                prefix: '+267',
                name: 'Botswana',
                currency: 'BWP',
                currencySymbol: 'P',
                currencyName: 'Pula',
                paymentMethods: ['Orange Money', 'Mascom MyZaka']
            },
            'madagascar': {
                prefix: '+261',
                name: 'Madagascar',
                currency: 'MGA',
                currencySymbol: 'Ar',
                currencyName: 'Ariary',
                paymentMethods: ['MVola', 'Airtel Money']
            },
            'mozambique': {
                prefix: '+258',
                name: 'Mozambique',
                currency: 'MZN',
                currencySymbol: 'MT',
                currencyName: 'Metical',
                paymentMethods: ['M-Pesa', 'E-mola']
            },
            'zambie': {
                prefix: '+260',
                name: 'Zambie',
                currency: 'ZMW',
                currencySymbol: 'ZK',
                currencyName: 'Kwacha',
                paymentMethods: ['Airtel Money', 'MTN Mobile Money']
            },
            'zimbabwe': {
                prefix: '+263',
                name: 'Zimbabwe',
                currency: 'USD',
                currencySymbol: '$',
                currencyName: 'Dollar US',
                paymentMethods: ['EcoCash', 'OneMoney', 'Bank Transfer']
            }
        };

        // Variables globales
        let currentUser = null;
        const whatsappNumber = "237640352524"; // Num√©ro WhatsApp de Boosteph

        // V√©rifier l'authentification
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
            } else {
                window.location.href = 'connexion.html';
            }
        });

        // Charger les donn√©es utilisateur pour afficher le solde
        async function loadUserData() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    document.getElementById('currentBalance').textContent = 
                        `${(userData.balance || 0).toLocaleString('fr-FR')} XAF`;
                    
                    // Pr√©-remplir l'email avec celui de Firebase Auth
                    document.getElementById('userEmail').value = currentUser.email || userData.email || '';
                    
                    // Pr√©-remplir le nom complet
                    if (userData.fullName) {
                        document.getElementById('fullName').value = userData.fullName;
                    } else if (userData.displayName) {
                        document.getElementById('fullName').value = userData.displayName;
                    } else if (currentUser.displayName) {
                        document.getElementById('fullName').value = currentUser.displayName;
                    } else if (userData.username) {
                        document.getElementById('fullName').value = userData.username;
                    }
                    
                    // Pr√©-remplir le t√©l√©phone si disponible
                    if (userData.phoneNumber) {
                        const phone = userData.phoneNumber;
                        if (phone.startsWith('+')) {
                            const prefixMatch = phone.match(/^\+(\d{1,4})/);
                            if (prefixMatch) {
                                const prefix = '+' + prefixMatch[1];
                                const number = phone.substring(prefixMatch[0].length).trim();
                                
                                for (const [code, data] of Object.entries(countriesData)) {
                                    if (data.prefix === prefix) {
                                        document.getElementById('country').value = code;
                                        updateCountryInfo();
                                        break;
                                    }
                                }
                                
                                document.getElementById('phoneNumber').value = number;
                            }
                        } else {
                            document.getElementById('phoneNumber').value = phone;
                        }
                    }
                }
            } catch (error) {
                console.error("Erreur:", error);
            }
        }

        // Mettre √† jour les informations du pays s√©lectionn√©
        function updateCountryInfo() {
            const country = document.getElementById('country').value;
            
            if (!country || !countriesData[country]) {
                return;
            }
            
            const countryData = countriesData[country];
            const currency = countryData.currency;
            
            // Mettre √† jour l'indicatif t√©l√©phonique
            document.getElementById('phonePrefix').textContent = countryData.prefix;
            
            // Mettre √† jour la monnaie
            document.getElementById('currencySymbol').textContent = countryData.currencySymbol;
            document.getElementById('localCurrency').textContent = countryData.currencySymbol;
            document.getElementById('minCurrency').textContent = countryData.currencySymbol;
            document.getElementById('displayLocalCurrency').textContent = countryData.currencySymbol;
            
            // Mettre √† jour les m√©thodes de paiement
            const paymentMethodSelect = document.getElementById('paymentMethod');
            paymentMethodSelect.innerHTML = '<option value="">S√©lectionnez une m√©thode</option>';
            
            countryData.paymentMethods.forEach(method => {
                const option = document.createElement('option');
                option.value = method;
                option.textContent = method;
                paymentMethodSelect.appendChild(option);
            });
            
            // Ajouter option "Autre" si n√©cessaire
            const otherOption = document.createElement('option');
            otherOption.value = 'autre';
            otherOption.textContent = 'Autre m√©thode';
            paymentMethodSelect.appendChild(otherOption);
            
            // Calculer et afficher le montant minimum
            calculateAndDisplayMinAmount(currency);
            
            // Mettre √† jour le r√©sum√©
            updateSummary();
        }

        // Calculer et afficher le montant minimum
        function calculateAndDisplayMinAmount(currency) {
            const exchangeRate = exchangeRates[currency] || 1;
            
            // Montant minimum en XAF = 1000 XAF
            const minAmountXAF = 1000;
            
            // Calculer le montant minimum en monnaie locale
            let minAmountLocal;
            if (exchangeRate > 0) {
                minAmountLocal = Math.ceil(minAmountXAF / exchangeRate);
            } else {
                minAmountLocal = minAmountXAF;
            }
            
            // Arrondir √† la centaine sup√©rieure pour les montants √©lev√©s
            if (minAmountLocal > 100) {
                minAmountLocal = Math.ceil(minAmountLocal / 100) * 100;
            }
            
            // Mettre √† jour l'interface
            const country = document.getElementById('country').value;
            const countryData = countriesData[country];
            
            if (countryData) {
                document.getElementById('amount').min = minAmountLocal;
                document.getElementById('amount').placeholder = `Ex: ${minAmountLocal.toLocaleString('fr-FR')}`;
                
                document.getElementById('minAmountDisplay').textContent = minAmountLocal.toLocaleString('fr-FR');
                document.getElementById('minXAF').textContent = `${minAmountXAF.toLocaleString('fr-FR')} XAF`;
                
                // Mettre √† jour la conversion info avec le montant par d√©faut
                const defaultAmount = minAmountLocal;
                const xafEquivalent = Math.round(defaultAmount * exchangeRate);
                
                document.getElementById('localAmount').textContent = defaultAmount.toLocaleString('fr-FR');
                document.getElementById('xafAmount').textContent = `${xafEquivalent.toLocaleString('fr-FR')} XAF`;
            }
        }

        // Mettre √† jour le r√©sum√©
        function updateSummary() {
            const country = document.getElementById('country').value;
            const method = document.getElementById('paymentMethod').value;
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            
            if (country && countriesData[country]) {
                const countryData = countriesData[country];
                const currency = countryData.currency;
                const exchangeRate = exchangeRates[currency] || 1;
                
                // Calculer l'√©quivalent en XAF
                const amountXAF = Math.round(amount * exchangeRate);
                
                // Mettre √† jour les affichages
                document.getElementById('displayCountry').textContent = countryData.name;
                document.getElementById('displayLocalAmount').textContent = amount.toLocaleString('fr-FR');
                document.getElementById('displayXAF').textContent = `${amountXAF.toLocaleString('fr-FR')} XAF`;
                document.getElementById('displayTotal').textContent = `${amountXAF.toLocaleString('fr-FR')} XAF`;
                
                // Mettre √† jour l'info de conversion
                document.getElementById('localAmount').textContent = amount.toLocaleString('fr-FR');
                document.getElementById('xafAmount').textContent = `${amountXAF.toLocaleString('fr-FR')} XAF`;
                
                if (method) {
                    document.getElementById('displayMethod').textContent = method;
                } else {
                    document.getElementById('displayMethod').textContent = '-';
                }
                
                // Valider le formulaire
                validateForm();
            }
        }

        // Valider le formulaire
        function validateForm() {
            const country = document.getElementById('country').value;
            const method = document.getElementById('paymentMethod').value;
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const phone = document.getElementById('phoneNumber').value;
            const email = document.getElementById('userEmail').value;
            const fullName = document.getElementById('fullName').value;
            const submitBtn = document.getElementById('submitBtn');
            
            if (!country || !countriesData[country]) {
                submitBtn.disabled = true;
                return;
            }
            
            const countryData = countriesData[country];
            const currency = countryData.currency;
            const exchangeRate = exchangeRates[currency] || 1;
            
            // Calculer le montant minimum en monnaie locale
            const minAmountXAF = 1000;
            const minAmountLocal = Math.ceil(minAmountXAF / exchangeRate);
            
            // Validation de l'email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            // Calculer l'√©quivalent en XAF
            const amountXAF = amount * exchangeRate;
            
            // Activer/d√©sactiver le bouton
            const isValid = country && 
                          method && 
                          amount >= minAmountLocal && 
                          amountXAF >= 1000 && // Au moins 1000 XAF
                          phone && phone.length >= 8 && 
                          email && emailRegex.test(email) && 
                          fullName;
            
            submitBtn.disabled = !isValid;
        }

        // Fonctions d'alerte
        function showSuccess(message) {
            const alert = document.getElementById('successAlert');
            document.getElementById('successMessage').textContent = message;
            alert.className = 'alert alert-success';
            alert.style.display = 'flex';
        }

        function showError(message) {
            const alert = document.getElementById('errorAlert');
            document.getElementById('errorMessage').textContent = message;
            alert.className = 'alert alert-error';
            alert.style.display = 'flex';
        }

        function hideAlerts() {
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('errorAlert').style.display = 'none';
        }

        function showLoader(show) {
            document.getElementById('loader').style.display = show ? 'block' : 'none';
            document.getElementById('submitBtn').disabled = show;
        }

        // G√©rer la soumission du formulaire WhatsApp
        async function handleWhatsAppSubmit() {
            const country = document.getElementById('country').value;
            const method = document.getElementById('paymentMethod').value;
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const phonePrefix = document.getElementById('phonePrefix').textContent;
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const fullName = document.getElementById('fullName').value.trim();
            const additionalInfo = document.getElementById('additionalInfo').value.trim();
            
            if (!country || !countriesData[country]) {
                showError('Veuillez s√©lectionner un pays valide');
                return;
            }
            
            const countryData = countriesData[country];
            const currency = countryData.currency;
            const exchangeRate = exchangeRates[currency] || 1;
            const fullPhone = `${phonePrefix} ${phoneNumber}`;
            const amountXAF = Math.round(amount * exchangeRate);
            
            // Validation
            const minAmountXAF = 1000;
            const minAmountLocal = Math.ceil(minAmountXAF / exchangeRate);
            
            if (amount < minAmountLocal) {
                showError(`Le montant minimum est de ${minAmountLocal.toLocaleString('fr-FR')} ${countryData.currencySymbol}`);
                return;
            }
            
            if (amountXAF < 1000) {
                showError(`Le montant doit √™tre d'au moins 1000 XAF (environ ${minAmountLocal.toLocaleString('fr-FR')} ${countryData.currencySymbol})`);
                return;
            }
            
            if (!phoneNumber || phoneNumber.length < 8) {
                showError('Veuillez entrer un num√©ro de t√©l√©phone valide');
                return;
            }

            if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showError('Veuillez entrer une adresse email valide');
                return;
            }

            if (!fullName) {
                showError('Veuillez entrer votre nom complet');
                return;
            }

            try {
                showLoader(true);
                hideAlerts();

                // Cr√©er le message WhatsApp (SANS ENREGISTREMENT DANS LA BASE DE DONN√âES)
                const message = `üì± *DEMANDE DE RECHARGE BOOSTEPH* üì±

üë§ *Client:* ${fullName}
üìß *Email:* ${email}
üåç *Pays:* ${countryData.name}
üí∞ *Montant local:* ${amount.toLocaleString('fr-FR')} ${countryData.currencySymbol} (${countryData.currency})
üí∞ *Montant XAF:* ${amountXAF.toLocaleString('fr-FR')} XAF
üì± *M√©thode de paiement:* ${method}
‚òéÔ∏è *Num√©ro:* ${fullPhone}
üìù *Informations suppl√©mentaires:* ${additionalInfo || 'Aucune'}
üÜî *ID Utilisateur:* ${currentUser.uid}

‚è∞ *Date:* ${new Date().toLocaleString('fr-FR')}

‚úÖ Le client attend votre confirmation de paiement.`;

                // Encoder le message pour l'URL
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;

                showSuccess('Redirection vers WhatsApp...');
                
                // Ouvrir WhatsApp
                setTimeout(() => {
                    window.open(whatsappUrl, '_blank');
                    showLoader(false);
                }, 1000);

            } catch (error) {
                console.error("Erreur:", error);
                showError('Erreur lors de l\'envoi vers WhatsApp');
                showLoader(false);
            }
        }

        // Initialiser les √©v√©nements
        document.addEventListener('DOMContentLoaded', function() {
            // G√©rer le changement de pays
            document.getElementById('country').addEventListener('change', function() {
                updateCountryInfo();
            });
            
            // G√©rer le changement de montant
            document.getElementById('amount').addEventListener('input', function() {
                updateSummary();
            });
            
            // G√©rer les autres changements
            document.getElementById('paymentMethod').addEventListener('change', updateSummary);
            document.getElementById('phoneNumber').addEventListener('input', updateSummary);
            document.getElementById('userEmail').addEventListener('input', updateSummary);
            document.getElementById('fullName').addEventListener('input', updateSummary);
            document.getElementById('additionalInfo').addEventListener('input', updateSummary);
            
            // G√©rer la soumission WhatsApp
            document.getElementById('submitBtn').addEventListener('click', handleWhatsAppSubmit);
            
            // Initialiser avec un pays par d√©faut
            updateCountryInfo();
        });
    </script>
</body>
</html>