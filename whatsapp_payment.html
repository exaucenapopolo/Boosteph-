<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Paiement Autres Pays Africains - Likeo Boost</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@800;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary-yellow: #FFD700;
            --primary-blue: #2A5EE8;
            --primary-orange: #FF7A00;
            --dark-blue: #1A1F3C;
            --light-blue: #F0F5FF;
            --light-gray: #F8F9FA;
            --text-dark: #333333;
            --text-light: #777777;
            --white: #FFFFFF;
            --success-green: #4CAF50;
            --error-red: #f44336;
            --warning-orange: #ff9800;
            --whatsapp-green: #25D366;
            --whatsapp-dark: #128C7E;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: #f5f7ff;
            min-height: 100vh;
        }

        h1, h2, h3, h4 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 1rem;
        }

        .container { width: 100%; max-width: 100%; margin: 0 auto; padding: 0 15px; }

        .btn {
            display: inline-block; padding: 12px 24px;
            border-radius: 50px; text-decoration: none;
            font-weight: 600; font-size: 0.95rem;
            transition: var(--transition); cursor: pointer;
            border: none; text-align: center; white-space: nowrap;
        }

        .btn-primary { background-color: var(--primary-blue); color: var(--white); }
        .btn-primary:hover {
            background-color: var(--primary-orange);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(255, 122, 0, 0.2);
        }

        .btn-yellow {
            background-color: var(--primary-yellow);
            color: var(--dark-blue);
            font-weight: 700;
        }
        .btn-yellow:hover {
            background-color: #e6c200;
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-success { background-color: var(--success-green); color: var(--white); }
        .btn-success:hover { background-color: #3d8b40; }

        .btn-whatsapp {
            background-color: var(--whatsapp-green);
            color: var(--white);
            font-weight: 700;
            width: 100%;
            padding: 18px;
            font-size: 1.1rem;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-whatsapp:hover {
            background-color: #1da851;
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(37, 211, 102, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .mobile-header {
            background-color: var(--white); padding: 15px 0;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            position: sticky; top: 0; z-index: 100; width: 100%;
        }

        .mobile-header-content { display: flex; justify-content: space-between; align-items: center; }

        .logo {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900; font-size: 1.5rem;
            color: var(--dark-blue); text-decoration: none;
            display: flex; align-items: center;
        }
        .logo span { color: var(--primary-blue); }
        .logo .dot { color: var(--primary-orange); font-size: 1.8rem; line-height: 1; }
        .logo .yellow { color: var(--primary-yellow); }

        .back-btn {
            background: none; border: none;
            font-size: 1.2rem; color: var(--primary-blue);
            cursor: pointer; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; transition: var(--transition);
            text-decoration: none;
        }
        .back-btn:hover { background-color: rgba(42, 94, 232, 0.1); }

        .main-content { padding: 20px 0 40px; }

        .page-title {
            text-align: center;
            margin-bottom: 30px;
        }
        .page-title h1 {
            font-size: 1.8rem;
            color: var(--dark-blue);
            margin-bottom: 5px;
        }
        .page-title p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .deposit-section {
            background: var(--white);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.2rem;
            color: var(--dark-blue);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title i {
            color: var(--primary-blue);
        }

        .info-box {
            background: var(--light-blue);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary-orange);
        }
        .info-box h3 {
            color: var(--dark-blue);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        .info-box p {
            color: var(--text-dark);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .info-box ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        .info-box li {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-dark);
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
            background-color: var(--white);
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
        }
        .form-group .form-note {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 5px;
        }
        .form-group .form-error {
            font-size: 0.85rem;
            color: var(--error-red);
            margin-top: 5px;
            display: none;
        }

        .currency-group {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 15px;
        }

        .phone-group {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 15px;
            align-items: center;
        }
        .phone-prefix {
            background: var(--light-gray);
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            font-weight: 500;
            min-width: 120px;
            text-align: center;
        }

        .min-amount-info {
            background: var(--light-blue);
            padding: 12px 15px;
            border-radius: 10px;
            margin-top: 10px;
            border: 1px dashed var(--primary-blue);
            font-size: 0.9rem;
        }
        .min-amount-info strong {
            color: var(--dark-blue);
        }

        .payment-summary {
            background: var(--light-gray);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .payment-summary .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .payment-summary .row:last-child {
            margin-bottom: 0;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
            font-weight: 700;
            font-size: 1.1rem;
        }
        .payment-summary .label {
            color: var(--text-light);
        }

        .whatsapp-note {
            background: rgba(37, 211, 102, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            border: 1px solid rgba(37, 211, 102, 0.3);
        }
        .whatsapp-note i {
            color: var(--whatsapp-green);
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        .whatsapp-note p {
            font-size: 0.9rem;
            color: var(--text-dark);
            line-height: 1.5;
        }

        .loading-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }
        .loading-overlay.hidden { display: none; }
        .loading-spinner {
            width: 50px; height: 50px;
            border: 4px solid #e0e0e0;
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading-text {
            margin-top: 15px;
            color: var(--text-dark);
            font-weight: 500;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Alert Styles */
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: rgba(54, 211, 153, 0.1);
            color: var(--success-green);
            border: 1px solid var(--success-green);
        }

        .alert-error {
            background: rgba(255, 71, 87, 0.1);
            color: var(--error-red);
            border: 1px solid var(--error-red);
        }

        .amount-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .amount-option {
            padding: 15px;
            border: 2px solid rgba(42, 94, 232, 0.1);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--text-dark);
        }

        .amount-option:hover, .amount-option.selected {
            border-color: var(--primary-blue);
            background: rgba(42, 94, 232, 0.05);
            color: var(--primary-blue);
        }

        .payment-methods {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-method {
            flex: 1;
            padding: 15px;
            border: 2px solid rgba(42, 94, 232, 0.1);
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover, .payment-method.selected {
            border-color: var(--primary-blue);
            background: rgba(42, 94, 232, 0.05);
        }

        .payment-method i {
            font-size: 24px;
            margin-bottom: 5px;
            display: block;
        }

        .payment-method span {
            display: block;
            font-size: 12px;
            color: var(--text-light);
        }

        @media (min-width: 768px) {
            .container { max-width: 600px; }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <div class="loading-text">Chargement...</div>
    </div>

    <header class="mobile-header">
        <div class="container">
            <div class="mobile-header-content">
                <a href="depot.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <a href="dashboard.html" class="logo">Lik<span class="yellow">e</span>o<span class="dot">.</span>Boost</a>
                <div style="width: 40px;"></div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="page-title">
                <h1><i class="fas fa-globe-africa"></i> Paiement Autres Pays</h1>
                <p>Formulaire de paiement pour les autres pays africains</p>
            </div>

            <div class="alert" id="successAlert">
                <i class="fas fa-check-circle"></i>
                <span id="successMessage"></span>
            </div>

            <div class="alert" id="errorAlert">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorMessage"></span>
            </div>

            <div class="info-box">
                <h3><i class="fas fa-info-circle"></i> Comment √ßa marche ?</h3>
                <p>Pour effectuer un d√©p√¥t depuis un autre pays africain, veuillez remplir ce formulaire avec vos informations de paiement. Une fois le formulaire soumis :</p>
                <ul>
                    <li>Vous serez redirig√© vers WhatsApp avec un message pr√©-rempli</li>
                    <li>Notre √©quipe vous r√©pondra rapidement pour vous expliquer la proc√©dure</li>
                    <li>Nous cr√©erons un lien de paiement personnalis√© pour vous</li>
                    <li>Vous recevrez le lien de paiement par WhatsApp ou email</li>
                    <li>Apr√®s paiement, votre solde sera cr√©dit√© dans les plus brefs d√©lais</li>
                </ul>
                <p><strong>Num√©ro WhatsApp : +237 654 49 46 84</strong></p>
            </div>

            <div class="deposit-section">
                <h3 class="section-title"><i class="fas fa-file-invoice-dollar"></i> Formulaire de Paiement</h3>

                <form id="paymentForm">
                    <div class="form-group">
                        <label>Montant rapide (XAF)</label>
                        <div class="amount-options">
                            <div class="amount-option" data-amount="5000">5 000 XAF</div>
                            <div class="amount-option" data-amount="10000">10 000 XAF</div>
                            <div class="amount-option" data-amount="20000">20 000 XAF</div>
                            <div class="amount-option" data-amount="50000">50 000 XAF</div>
                            <div class="amount-option" data-amount="100000">100 000 XAF</div>
                            <div class="amount-option" data-amount="200000">200 000 XAF</div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customAmount">Ou montant personnalis√© (XAF)</label>
                        <input type="number" id="customAmount" placeholder="Ex: 15000" min="5000">
                    </div>

                    <div class="form-group">
                        <label for="country">Pays *</label>
                        <select id="country" required>
                            <option value="">S√©lectionnez votre pays</option>
                            <!-- Afrique de l'Ouest -->
                            <option value="benin">B√©nin</option>
                            <option value="burkina-faso">Burkina Faso</option>
                            <option value="cote-ivoire">C√¥te d'Ivoire</option>
                            <option value="gambie">Gambie</option>
                            <option value="ghana">Ghana</option>
                            <option value="guinee">Guin√©e</option>
                            <option value="guinee-bissau">Guin√©e-Bissau</option>
                            <option value="liberia">Lib√©ria</option>
                            <option value="mali">Mali</option>
                            <option value="niger">Niger</option>
                            <option value="nigeria">Nigeria</option>
                            <option value="senegal">S√©n√©gal</option>
                            <option value="sierra-leone">Sierra Leone</option>
                            <option value="togo">Togo</option>
                            
                            <!-- Afrique Centrale -->
                            <option value="gabon">Gabon</option>
                            <option value="guinee-equatoriale">Guin√©e √âquatoriale</option>
                            <option value="rdc">R√©publique D√©mocratique du Congo</option>
                            <option value="republique-centrafricaine">R√©publique Centrafricaine</option>
                            <option value="republique-congo">R√©publique du Congo</option>
                            <option value="tchad">Tchad</option>
                            
                            <!-- Afrique de l'Est -->
                            <option value="burundi">Burundi</option>
                            <option value="djibouti">Djibouti</option>
                            <option value="erythree">√ârythr√©e</option>
                            <option value="ethiopie">√âthiopie</option>
                            <option value="kenya">Kenya</option>
                            <option value="rwanda">Rwanda</option>
                            <option value="somalie">Somalie</option>
                            <option value="soudan">Soudan</option>
                            <option value="soudan-sud">Soudan du Sud</option>
                            <option value="tanzanie">Tanzanie</option>
                            <option value="uganda">Ouganda</option>
                            
                            <!-- Afrique Australe -->
                            <option value="angola">Angola</option>
                            <option value="botswana">Botswana</option>
                            <option value="comores">Comores</option>
                            <option value="lesotho">Lesotho</option>
                            <option value="madagascar">Madagascar</option>
                            <option value="malawi">Malawi</option>
                            <option value="ile-maurice">√éle Maurice</option>
                            <option value="mozambique">Mozambique</option>
                            <option value="namibie">Namibie</option>
                            <option value="seychelles">Seychelles</option>
                            <option value="afrique-sud">Afrique du Sud</option>
                            <option value="swaziland">Eswatini (Swaziland)</option>
                            <option value="zambie">Zambie</option>
                            <option value="zimbabwe">Zimbabwe</option>
                        </select>
                        <div class="form-note">S√©lectionnez votre pays de r√©sidence</div>
                    </div>

                    <div class="form-group">
                        <label for="phoneNumber">Num√©ro de t√©l√©phone Mobile Money *</label>
                        <div class="phone-group">
                            <div class="phone-prefix" id="phonePrefix">+229</div>
                            <input type="tel" id="phoneNumber" required placeholder="Ex: 01 23 45 67">
                        </div>
                        <div class="form-note">Format : indicatif du pays + num√©ro</div>
                    </div>

                    <div class="form-group">
                        <label>Mode de paiement *</label>
                        <div class="payment-methods">
                            <div class="payment-method selected" data-method="momo">
                                <i class="fas fa-mobile-alt" style="color: #FFCC00;"></i>
                                <span>MTN Mobile Money</span>
                            </div>
                            <div class="payment-method" data-method="om">
                                <i class="fas fa-mobile-alt" style="color: #FF6600;"></i>
                                <span>Orange Money</span>
                            </div>
                            <div class="payment-method" data-method="wave">
                                <i class="fas fa-wave-square" style="color: #00AEF0;"></i>
                                <span>Wave</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="fullName">Nom complet *</label>
                        <input type="text" id="fullName" required placeholder="Votre nom complet">
                    </div>

                    <div class="form-group">
                        <label for="userEmail">Adresse email *</label>
                        <input type="email" id="userEmail" required placeholder="Ex: votrenom@email.com">
                        <div class="form-note">L'adresse email utilis√©e pour votre compte Likeo Boost</div>
                        <div class="form-error" id="emailError">Cette adresse email n'est pas valide</div>
                    </div>

                    <div class="form-group">
                        <label for="additionalInfo">Informations suppl√©mentaires</label>
                        <textarea id="additionalInfo" rows="3" placeholder="Op√©rateur, nom de l'exp√©diteur, ou autres d√©tails utiles..."></textarea>
                        <div class="form-note">Ces informations nous aident √† traiter votre demande rapidement</div>
                    </div>

                    <div class="payment-summary">
                        <div class="row">
                            <span class="label">Montant</span>
                            <span id="displayAmount">0</span>
                        </div>
                        <div class="row">
                            <span class="label">Pays</span>
                            <span id="displayCountry">-</span>
                        </div>
                        <div class="row">
                            <span class="label">M√©thode</span>
                            <span id="displayMethod">-</span>
                        </div>
                        <div class="row">
                            <span class="label">Num√©ro</span>
                            <span id="displayPhone">-</span>
                        </div>
                        <div class="row">
                            <span class="label">Total √† payer</span>
                            <span id="displayTotal">0 XAF</span>
                        </div>
                    </div>

                    <div class="whatsapp-note">
                        <i class="fab fa-whatsapp"></i>
                        <p>Apr√®s avoir cliqu√© sur le bouton, vous serez redirig√© vers WhatsApp avec un message pr√©-rempli. Notre √©quipe vous r√©pondra rapidement pour vous expliquer la proc√©dure et vous envoyer votre lien de paiement personnalis√©.</p>
                    </div>

                    <button type="button" class="btn btn-whatsapp" id="submitBtn">
                        <i class="fab fa-whatsapp"></i> Envoyer la demande sur WhatsApp
                    </button>
                </form>
            </div>
        </div>
    </main>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDp4CpK_L6jlvE63eW4Q4BCemGPoXarbrw",
            authDomain: "likeo-5e3e9.firebaseapp.com",
            projectId: "likeo-5e3e9",
            storageBucket: "likeo-5e3e9.firebasestorage.app",
            messagingSenderId: "1071170297332",
            appId: "1:1071170297332:web:fa5e60f75848b986712da1",
            measurementId: "G-RV38D7VYF5"
        };

        // Donn√©es des pays avec indicatifs
        const countriesData = {
            'benin': { prefix: '+229', name: 'B√©nin' },
            'burkina-faso': { prefix: '+226', name: 'Burkina Faso' },
            'cote-ivoire': { prefix: '+225', name: 'C√¥te d\'Ivoire' },
            'gambie': { prefix: '+220', name: 'Gambie' },
            'ghana': { prefix: '+233', name: 'Ghana' },
            'guinee': { prefix: '+224', name: 'Guin√©e' },
            'guinee-bissau': { prefix: '+245', name: 'Guin√©e-Bissau' },
            'liberia': { prefix: '+231', name: 'Lib√©ria' },
            'mali': { prefix: '+223', name: 'Mali' },
            'niger': { prefix: '+227', name: 'Niger' },
            'nigeria': { prefix: '+234', name: 'Nigeria' },
            'senegal': { prefix: '+221', name: 'S√©n√©gal' },
            'sierra-leone': { prefix: '+232', name: 'Sierra Leone' },
            'togo': { prefix: '+228', name: 'Togo' },
            'gabon': { prefix: '+241', name: 'Gabon' },
            'guinee-equatoriale': { prefix: '+240', name: 'Guin√©e √âquatoriale' },
            'rdc': { prefix: '+243', name: 'R√©publique D√©mocratique du Congo' },
            'republique-centrafricaine': { prefix: '+236', name: 'R√©publique Centrafricaine' },
            'republique-congo': { prefix: '+242', name: 'R√©publique du Congo' },
            'tchad': { prefix: '+235', name: 'Tchad' },
            'burundi': { prefix: '+257', name: 'Burundi' },
            'djibouti': { prefix: '+253', name: 'Djibouti' },
            'erythree': { prefix: '+291', name: '√ârythr√©e' },
            'ethiopie': { prefix: '+251', name: '√âthiopie' },
            'kenya': { prefix: '+254', name: 'Kenya' },
            'rwanda': { prefix: '+250', name: 'Rwanda' },
            'somalie': { prefix: '+252', name: 'Somalie' },
            'soudan': { prefix: '+249', name: 'Soudan' },
            'soudan-sud': { prefix: '+211', name: 'Soudan du Sud' },
            'tanzanie': { prefix: '+255', name: 'Tanzanie' },
            'uganda': { prefix: '+256', name: 'Ouganda' },
            'angola': { prefix: '+244', name: 'Angola' },
            'botswana': { prefix: '+267', name: 'Botswana' },
            'comores': { prefix: '+269', name: 'Comores' },
            'lesotho': { prefix: '+266', name: 'Lesotho' },
            'madagascar': { prefix: '+261', name: 'Madagascar' },
            'malawi': { prefix: '+265', name: 'Malawi' },
            'ile-maurice': { prefix: '+230', name: '√éle Maurice' },
            'mozambique': { prefix: '+258', name: 'Mozambique' },
            'namibie': { prefix: '+264', name: 'Namibie' },
            'seychelles': { prefix: '+248', name: 'Seychelles' },
            'afrique-sud': { prefix: '+27', name: 'Afrique du Sud' },
            'swaziland': { prefix: '+268', name: 'Eswatini (Swaziland)' },
            'zambie': { prefix: '+260', name: 'Zambie' },
            'zimbabwe': { prefix: '+263', name: 'Zimbabwe' }
        };

        // Variables globales
        let currentUser = null;
        let selectedAmount = 0;
        const whatsappNumber = "237654494684";

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // V√©rifier l'authentification
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
                document.getElementById('loadingOverlay').classList.add('hidden');
            } else {
                window.location.href = 'connexion.html';
            }
        });

        // Charger les donn√©es utilisateur
        async function loadUserData() {
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    
                    // Pr√©-remplir l'email
                    document.getElementById('userEmail').value = currentUser.email || userData.email || '';
                    
                    // Pr√©-remplir le nom complet
                    if (userData.fullName) {
                        document.getElementById('fullName').value = userData.fullName;
                    } else if (userData.displayName) {
                        document.getElementById('fullName').value = userData.displayName;
                    } else if (currentUser.displayName) {
                        document.getElementById('fullName').value = currentUser.displayName;
                    }
                    
                    // Pr√©-remplir le t√©l√©phone si disponible
                    if (userData.phoneNumber) {
                        const phone = userData.phoneNumber;
                        // Extraire l'indicatif et le num√©ro
                        if (phone.startsWith('+')) {
                            const prefixMatch = phone.match(/^\+(\d{1,4})/);
                            if (prefixMatch) {
                                const prefix = '+' + prefixMatch[1];
                                const number = phone.substring(prefixMatch[0].length).trim();
                                
                                // Trouver le pays correspondant √† l'indicatif
                                for (const [code, data] of Object.entries(countriesData)) {
                                    if (data.prefix === prefix) {
                                        document.getElementById('country').value = code;
                                        updatePhonePrefix();
                                        break;
                                    }
                                }
                                
                                document.getElementById('phoneNumber').value = number;
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Erreur chargement donn√©es:', error);
            }
        }

        // Gestion des montants rapides
        document.querySelectorAll('.amount-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.amount-option').forEach(o => o.classList.remove('selected'));
                this.classList.add('selected');
                selectedAmount = parseInt(this.dataset.amount);
                document.getElementById('customAmount').value = selectedAmount;
                updateSummary();
            });
        });

        // Gestion du montant personnalis√©
        document.getElementById('customAmount').addEventListener('input', function() {
            selectedAmount = parseInt(this.value) || 0;
            document.querySelectorAll('.amount-option').forEach(o => o.classList.remove('selected'));
            updateSummary();
        });

        // Gestion des m√©thodes de paiement
        document.querySelectorAll('.payment-method').forEach(method => {
            method.addEventListener('click', function() {
                document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                this.classList.add('selected');
                updateSummary();
            });
        });

        // Mettre √† jour l'indicatif du t√©l√©phone
        function updatePhonePrefix() {
            const country = document.getElementById('country').value;
            const phonePrefix = document.getElementById('phonePrefix');
            
            if (country && countriesData[country]) {
                phonePrefix.textContent = countriesData[country].prefix;
            } else {
                phonePrefix.textContent = '+229'; // Valeur par d√©faut
            }
            updateSummary();
        }

        // Mettre √† jour le r√©sum√©
        function updateSummary() {
            const country = document.getElementById('country').value;
            const method = document.querySelector('.payment-method.selected')?.dataset.method;
            const amount = selectedAmount || parseInt(document.getElementById('customAmount').value) || 0;
            const phone = document.getElementById('phoneNumber').value;
            const prefix = document.getElementById('phonePrefix').textContent;
            
            // Mettre √† jour les affichages
            if (country && countriesData[country]) {
                document.getElementById('displayCountry').textContent = countriesData[country].name;
            } else {
                document.getElementById('displayCountry').textContent = '-';
            }
            
            if (method) {
                const methodNames = {
                    'momo': 'MTN Mobile Money',
                    'om': 'Orange Money',
                    'wave': 'Wave'
                };
                document.getElementById('displayMethod').textContent = methodNames[method] || method;
            } else {
                document.getElementById('displayMethod').textContent = '-';
            }
            
            document.getElementById('displayAmount').textContent = amount.toLocaleString('fr-FR') + ' XAF';
            document.getElementById('displayTotal').textContent = amount.toLocaleString('fr-FR') + ' XAF';
            
            if (phone) {
                document.getElementById('displayPhone').textContent = prefix + ' ' + phone;
            } else {
                document.getElementById('displayPhone').textContent = '-';
            }
            
            // Valider le formulaire
            validateForm();
        }

        // Valider le formulaire
        function validateForm() {
            const country = document.getElementById('country').value;
            const amount = selectedAmount || parseInt(document.getElementById('customAmount').value);
            const phone = document.getElementById('phoneNumber').value;
            const email = document.getElementById('userEmail').value;
            const fullName = document.getElementById('fullName').value;
            const submitBtn = document.getElementById('submitBtn');
            const emailError = document.getElementById('emailError');
            
            // Validation de l'email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email && !emailRegex.test(email)) {
                emailError.style.display = 'block';
            } else {
                emailError.style.display = 'none';
            }
            
            // Activer/d√©sactiver le bouton
            const isValid = country && 
                          amount && amount >= 5000 && 
                          phone && phone.length >= 8 && 
                          email && emailRegex.test(email) && 
                          fullName;
            
            submitBtn.disabled = !isValid;
        }

        // Afficher un message de succ√®s
        function showSuccess(message) {
            const alert = document.getElementById('successAlert');
            document.getElementById('successMessage').textContent = message;
            alert.className = 'alert alert-success';
            alert.style.display = 'flex';
        }

        // Afficher un message d'erreur
        function showError(message) {
            const alert = document.getElementById('errorAlert');
            document.getElementById('errorMessage').textContent = message;
            alert.className = 'alert alert-error';
            alert.style.display = 'flex';
        }

        // Cacher les alertes
        function hideAlerts() {
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('errorAlert').style.display = 'none';
        }

        // G√©rer la soumission du formulaire
        async function handleSubmit() {
            const country = document.getElementById('country').value;
            const method = document.querySelector('.payment-method.selected').dataset.method;
            const amount = selectedAmount || parseInt(document.getElementById('customAmount').value);
            const phonePrefix = document.getElementById('phonePrefix').textContent;
            const phoneNumber = document.getElementById('phoneNumber').value;
            const email = document.getElementById('userEmail').value;
            const fullName = document.getElementById('fullName').value;
            const additionalInfo = document.getElementById('additionalInfo').value;
            
            const fullPhone = `${phonePrefix} ${phoneNumber}`;
            
            // Validation
            if (!amount || amount < 5000) {
                showError('Le montant minimum est de 5000 XAF');
                return;
            }
            
            if (!phoneNumber || phoneNumber.length < 8) {
                showError('Veuillez entrer un num√©ro de t√©l√©phone valide');
                return;
            }

            try {
                // Enregistrer la demande dans Firebase
                await db.collection('whatsapp_payments').add({
                    userId: currentUser.uid,
                    fullName: fullName,
                    country: countriesData[country]?.name || country,
                    amount: amount,
                    phoneNumber: fullPhone,
                    email: email,
                    paymentMethod: method,
                    additionalInfo: additionalInfo,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Cr√©er le message WhatsApp
                const paymentMethodNames = {
                    'momo': 'MTN Mobile Money',
                    'om': 'Orange Money',
                    'wave': 'Wave'
                };

                const message = `üì± *DEMANDE DE RECHARGE LIKEO BOOST* üì±
                
üë§ *Client:* ${fullName}
üìß *Email:* ${email}
üåç *Pays:* ${countriesData[country]?.name || country}
üí∞ *Montant:* ${amount.toLocaleString('fr-FR')} XAF
üì± *M√©thode de paiement:* ${paymentMethodNames[method] || method}
‚òéÔ∏è *Num√©ro:* ${fullPhone}
üìù *Informations suppl√©mentaires:* ${additionalInfo || 'Aucune'}
üÜî *ID Utilisateur:* ${currentUser.uid}
‚è∞ *Date:* ${new Date().toLocaleString('fr-FR')}

‚úÖ Le client attend votre confirmation de paiement.`;

                // Encoder le message pour l'URL
                const encodedMessage = encodeURIComponent(message);
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;

                // Afficher message de succ√®s
                showSuccess('Demande enregistr√©e! WhatsApp va s\'ouvrir. Veuillez envoyer le message au support.');

                // Ouvrir WhatsApp apr√®s un court d√©lai
                setTimeout(() => {
                    window.open(whatsappUrl, '_blank');
                }, 2000);

            } catch (error) {
                console.error("Erreur:", error);
                showError('Erreur lors de l\'enregistrement de la demande');
            }
        }

        // Initialiser l'application
        function initializeApp() {
            // √âcouter les changements
            document.getElementById('country').addEventListener('change', updatePhonePrefix);
            document.getElementById('phoneNumber').addEventListener('input', updateSummary);
            document.getElementById('userEmail').addEventListener('input', updateSummary);
            document.getElementById('fullName').addEventListener('input', updateSummary);
            document.getElementById('additionalInfo').addEventListener('input', updateSummary);
            
            // G√©rer la soumission
            document.getElementById('submitBtn').addEventListener('click', handleSubmit);
            
            // Initialiser
            updatePhonePrefix();
            updateSummary();
        }

        // D√©marrer l'application
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>